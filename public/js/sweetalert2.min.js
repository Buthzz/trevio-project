/**
 * ===================================================================
 * TREVIO - SweetAlert2.min.js (Custom Wrapper)
 * SweetAlert2 alerts dan notifications wrapper
 * ===================================================================
 * Fitur:
 * - Success, error, warning, info alerts
 * - Confirmation dialogs
 * - Toast notifications
 * - Custom styling dengan Trevio theme
 * - Promise-based API
 * ===================================================================
 */

'use strict';

/**
 * SweetAlert Global Object
 * Wrapper untuk SweetAlert2 library dengan custom styling
 */
const SweetAlert = (function () {
  // Check if Swal is available
  if (typeof Swal === 'undefined') {
    console.warn('[SWEETALERT] SweetAlert2 library not loaded. Please include Swal library before this script.');
  }
  // ================================================================
  // ALERT STYLING & THEME
  // ================================================================

  const ALERT_THEME = {
    primary: '#4f46e5',
    success: '#10b981',
    danger: '#ef4444',
    warning: '#f59e0b',
    info: '#06b6d4',
    light: '#f3f4f6',
    dark: '#1f2937',
  };

  const ALERT_ICONS = {
    success: 'success',
    error: 'error',
    warning: 'warning',
    info: 'info',
    question: 'question',
  };

  // ================================================================
  // PRIVATE HELPERS
  // ================================================================

  /**
   * Get default alert styling
   * @returns {Object} Default alert config
   */
  const getDefaultConfig = () => ({
    allowOutsideClick: true,
    allowEscapeKey: true,
    buttonsStyling: true,
    didOpen: () => {
      // Focus first button
      const button = document.querySelector('.swal2-actions button');
      if (button) button.focus();
    },
  });

  /**
   * Get button styling
   * @param {string} type - Button type (confirm, cancel, etc)
   * @returns {string} Button CSS class
   */
  const getButtonClass = (type) => {
    const baseClass = 'px-4 py-2 rounded-lg font-medium transition-all duration-200 inline-flex items-center gap-2';
    const typeClasses = {
      confirm:
        'bg-accent hover:bg-accentLight text-white shadow-md hover:shadow-lg',
      cancel:
        'bg-slate-300 hover:bg-slate-400 text-slate-900 shadow-md hover:shadow-lg',
      deny: 'bg-slate-200 hover:bg-slate-300 text-slate-900',
    };
    return `${baseClass} ${typeClasses[type] || typeClasses.confirm}`;
  };

  /**
   * Parse icon dari config
   * @param {string|Object} icon - Icon config
   * @returns {string}
   */
  const parseIcon = (icon) => {
    if (typeof icon === 'string' && ALERT_ICONS[icon]) {
      return ALERT_ICONS[icon];
    }
    return icon;
  };

  // ================================================================
  // ALERT FUNCTIONS
  // ================================================================

  /**
   * Show success alert
   * @param {string} title - Alert title
   * @param {string} message - Alert message
   * @param {Object} options - Additional options
   * @returns {Promise}
   */
  const success = (title, message = '', options = {}) => {
    if (typeof Swal === 'undefined') {
      console.error('[SWEETALERT] Swal not available');
      return Promise.reject(new Error('Swal not available'));
    }
    return Swal.fire({
      ...getDefaultConfig(),
      icon: ALERT_ICONS.success,
      title: title || 'Sukses!',
      html: message,
      confirmButtonText: 'OK',
      confirmButtonColor: ALERT_THEME.success,
      confirmButtonClass: getButtonClass('confirm'),
      ...options,
    });
  };

  /**
   * Show error alert
   * @param {string} title - Alert title
   * @param {string} message - Alert message
   * @param {Object} options - Additional options
   * @returns {Promise}
   */
  const error = (title, message = '', options = {}) => {
    if (typeof Swal === 'undefined') {
      console.error('[SWEETALERT] Swal not available');
      return Promise.reject(new Error('Swal not available'));
    }
    return Swal.fire({
      ...getDefaultConfig(),
      icon: ALERT_ICONS.error,
      title: title || 'Oops!',
      html: message || 'Terjadi kesalahan. Silakan coba lagi.',
      confirmButtonText: 'OK',
      confirmButtonColor: ALERT_THEME.danger,
      confirmButtonClass: getButtonClass('confirm'),
      ...options,
    });
  };

  /**
   * Show warning alert
   * @param {string} title - Alert title
   * @param {string} message - Alert message
   * @param {Object} options - Additional options
   * @returns {Promise}
   */
  const warning = (title, message = '', options = {}) => {
    if (typeof Swal === 'undefined') {
      console.error('[SWEETALERT] Swal not available');
      return Promise.reject(new Error('Swal not available'));
    }
    return Swal.fire({
      ...getDefaultConfig(),
      icon: ALERT_ICONS.warning,
      title: title || 'Perhatian!',
      html: message,
      confirmButtonText: 'Lanjutkan',
      confirmButtonColor: ALERT_THEME.warning,
      confirmButtonClass: getButtonClass('confirm'),
      ...options,
    });
  };

  /**
   * Show info alert
   * @param {string} title - Alert title
   * @param {string} message - Alert message
   * @param {Object} options - Additional options
   * @returns {Promise}
   */
  const info = (title, message = '', options = {}) => {
    if (typeof Swal === 'undefined') {
      console.error('[SWEETALERT] Swal not available');
      return Promise.reject(new Error('Swal not available'));
    }
    return Swal.fire({
      ...getDefaultConfig(),
      icon: ALERT_ICONS.info,
      title: title || 'Informasi',
      html: message,
      confirmButtonText: 'OK',
      confirmButtonColor: ALERT_THEME.info,
      confirmButtonClass: getButtonClass('confirm'),
      ...options,
    });
  };

  /**
   * Show confirmation dialog
   * @param {string} title - Dialog title
   * @param {string} message - Dialog message
   * @param {Object} options - Additional options
   * @returns {Promise}
   */
  const confirm = (title, message = '', options = {}) => {
    if (typeof Swal === 'undefined') {
      console.error('[SWEETALERT] Swal not available');
      return Promise.reject(new Error('Swal not available'));
    }
    return Swal.fire({
      ...getDefaultConfig(),
      icon: ALERT_ICONS.question,
      title: title || 'Konfirmasi',
      html: message,
      confirmButtonText: 'Ya, Lanjutkan',
      cancelButtonText: 'Batal',
      confirmButtonColor: ALERT_THEME.primary,
      cancelButtonColor: ALERT_THEME.light,
      showCancelButton: true,
      confirmButtonClass: getButtonClass('confirm'),
      cancelButtonClass: getButtonClass('cancel'),
      ...options,
    });
  };

  /**
   * Show delete confirmation
   * @param {string} itemName - Item name to delete
   * @param {Object} options - Additional options
   * @returns {Promise}
   */
  const confirmDelete = (itemName = 'item ini', options = {}) => {
    if (typeof Swal === 'undefined') {
      console.error('[SWEETALERT] Swal not available');
      return Promise.reject(new Error('Swal not available'));
    }
    return Swal.fire({
      ...getDefaultConfig(),
      icon: ALERT_ICONS.warning,
      title: 'Hapus Data?',
      html: `Anda yakin ingin menghapus <strong>${itemName}</strong>? Tindakan ini tidak dapat dibatalkan.`,
      confirmButtonText: 'Ya, Hapus',
      cancelButtonText: 'Batal',
      confirmButtonColor: ALERT_THEME.danger,
      cancelButtonColor: ALERT_THEME.light,
      showCancelButton: true,
      confirmButtonClass: getButtonClass('confirm'),
      cancelButtonClass: getButtonClass('cancel'),
      ...options,
    });
  };

  /**
   * Show toast notification
   * @param {string} message - Toast message
   * @param {string} type - Toast type (success, error, warning, info)
   * @param {number} timer - Auto-close timer in milliseconds
   * @returns {Promise}
   */
  const toast = (message = '', type = 'info', timer = 3000) => {
    if (typeof Swal === 'undefined') {
      console.error('[SWEETALERT] Swal not available');
      return Promise.reject(new Error('Swal not available'));
    }
    
    const iconMap = {
      success: ALERT_ICONS.success,
      error: ALERT_ICONS.error,
      warning: ALERT_ICONS.warning,
      info: ALERT_ICONS.info,
    };

    return Swal.fire({
      icon: iconMap[type] || iconMap.info,
      title: message,
      toast: true,
      position: 'top-end',
      showConfirmButton: false,
      timer: timer,
      timerProgressBar: true,
      didOpen: (toast) => {
        // Pause timer on hover
        toast.addEventListener('mouseenter', Swal.stopTimer);
        toast.addEventListener('mouseleave', Swal.resumeTimer);
      },
    });
  };

  /**
   * Show custom alert dengan HTML content
   * @param {string} title - Alert title
   * @param {string} htmlContent - HTML content
   * @param {Object} options - Additional options
   * @returns {Promise}
   */
  const custom = (title, htmlContent = '', options = {}) => {
    if (typeof Swal === 'undefined') {
      console.error('[SWEETALERT] Swal not available');
      return Promise.reject(new Error('Swal not available'));
    }
    return Swal.fire({
      ...getDefaultConfig(),
      title: title,
      html: htmlContent,
      confirmButtonText: 'OK',
      confirmButtonColor: ALERT_THEME.primary,
      confirmButtonClass: getButtonClass('confirm'),
      ...options,
    });
  };

  /**
   * Show loading alert dengan spinner
   * @param {string} title - Alert title
   * @param {string} message - Alert message
   * @returns {Promise}
   */
  const loading = (title = 'Memuat...', message = '') => {
    if (typeof Swal === 'undefined') {
      console.error('[SWEETALERT] Swal not available');
      return Promise.reject(new Error('Swal not available'));
    }
    return Swal.fire({
      title: title,
      html: message,
      allowOutsideClick: false,
      allowEscapeKey: false,
      didOpen: async () => {
        Swal.showLoading();
      },
    });
  };

  /**
   * Close current alert
   */
  const close = () => {
    if (typeof Swal !== 'undefined') {
      Swal.close();
    }
  };

  /**
   * Hide alert but keep instance
   */
  const hide = () => {
    if (typeof Swal !== 'undefined') {
      Swal.hidePopup();
    }
  };

  /**
   * Show alert
   */
  const show = () => {
    if (typeof Swal !== 'undefined') {
      Swal.showPopup();
    }
  };

  /**
   * Enable confirm button
   */
  const enableConfirm = () => {
    if (typeof Swal !== 'undefined') {
      Swal.enableButtons();
    }
  };

  /**
   * Disable confirm button
   */
  const disableConfirm = () => {
    if (typeof Swal !== 'undefined') {
      Swal.disableButtons();
    }
  };

  /**
   * Update alert content
   * @param {Object} updates - Updates object
   */
  const update = (updates = {}) => {
    if (typeof Swal !== 'undefined') {
      Swal.update(updates);
    }
  };

  // ================================================================
  // PROMISE-BASED HELPERS
  // ================================================================

  /**
   * Async confirm dialog
   * @param {string} title - Dialog title
   * @param {string} message - Dialog message
   * @returns {Promise<boolean>}
   */
  const asyncConfirm = async (title, message = '') => {
    const result = await confirm(title, message);
    return result.isConfirmed;
  };

  /**
   * Async delete confirmation
   * @param {string} itemName - Item name
   * @returns {Promise<boolean>}
   */
  const asyncConfirmDelete = async (itemName = 'item ini') => {
    const result = await confirmDelete(itemName);
    return result.isConfirmed;
  };

  /**
   * Show success dengan auto-close
   * @param {string} title - Alert title
   * @param {string} message - Alert message
   * @param {number} timer - Timer in milliseconds
   * @returns {Promise}
   */
  const successAutoClose = (title, message = '', timer = 2000) => {
    return success(title, message, {
      timer: timer,
      timerProgressBar: true,
      showConfirmButton: false,
    });
  };

  /**
   * Show error dengan auto-close
   * @param {string} title - Alert title
   * @param {string} message - Alert message
   * @param {number} timer - Timer in milliseconds
   * @returns {Promise}
   */
  const errorAutoClose = (title, message = '', timer = 3000) => {
    return error(title, message, {
      timer: timer,
      timerProgressBar: true,
      showConfirmButton: false,
    });
  };

  // ================================================================
  // INPUT DIALOGS
  // ================================================================

  /**
   * Show text input dialog
   * @param {string} title - Dialog title
   * @param {string} message - Dialog message
   * @param {Object} options - Additional options
   * @returns {Promise}
   */
  const textInput = (title, message = '', options = {}) => {
    return Swal.fire({
      ...getDefaultConfig(),
      title: title,
      html: message,
      input: 'text',
      inputPlaceholder: options.placeholder || 'Masukkan teks...',
      showCancelButton: true,
      confirmButtonText: 'OK',
      cancelButtonText: 'Batal',
      confirmButtonColor: ALERT_THEME.primary,
      cancelButtonColor: ALERT_THEME.light,
      confirmButtonClass: getButtonClass('confirm'),
      cancelButtonClass: getButtonClass('cancel'),
      inputValidator: options.validator,
      ...options,
    });
  };

  /**
   * Show email input dialog
   * @param {string} title - Dialog title
   * @param {string} message - Dialog message
   * @param {Object} options - Additional options
   * @returns {Promise}
   */
  const emailInput = (title, message = '', options = {}) => {
    return Swal.fire({
      ...getDefaultConfig(),
      title: title,
      html: message,
      input: 'email',
      inputPlaceholder: 'Masukkan email...',
      showCancelButton: true,
      confirmButtonText: 'OK',
      cancelButtonText: 'Batal',
      confirmButtonColor: ALERT_THEME.primary,
      cancelButtonColor: ALERT_THEME.light,
      confirmButtonClass: getButtonClass('confirm'),
      cancelButtonClass: getButtonClass('cancel'),
      inputValidator: (value) => {
        if (!value) return 'Email tidak boleh kosong';
        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
          return 'Format email tidak valid';
        }
        if (options.validator) return options.validator(value);
      },
      ...options,
    });
  };

  /**
   * Show textarea input dialog
   * @param {string} title - Dialog title
   * @param {string} message - Dialog message
   * @param {Object} options - Additional options
   * @returns {Promise}
   */
  const textareaInput = (title, message = '', options = {}) => {
    return Swal.fire({
      ...getDefaultConfig(),
      title: title,
      html: message,
      input: 'textarea',
      inputPlaceholder: 'Masukkan teks...',
      inputAttributes: {
        rows: options.rows || 4,
        style: 'resize: vertical;',
      },
      showCancelButton: true,
      confirmButtonText: 'OK',
      cancelButtonText: 'Batal',
      confirmButtonColor: ALERT_THEME.primary,
      cancelButtonColor: ALERT_THEME.light,
      confirmButtonClass: getButtonClass('confirm'),
      cancelButtonClass: getButtonClass('cancel'),
      inputValidator: options.validator,
      ...options,
    });
  };

  /**
   * Show select dialog
   * @param {string} title - Dialog title
   * @param {Array} options - Select options [{value, label}]
   * @param {Object} config - Additional options
   * @returns {Promise}
   */
  const selectInput = (title, options = [], config = {}) => {
    const optionsHtml = options
      .map(
        (opt) =>
          `<option value="${opt.value}">${opt.label}</option>`
      )
      .join('');

    return Swal.fire({
      ...getDefaultConfig(),
      title: title,
      html: `<select id="swal-select" class="swal2-input" style="appearance: none; cursor: pointer; padding: 8px 12px;">
        <option value="">Pilih opsi...</option>
        ${optionsHtml}
      </select>`,
      showCancelButton: true,
      confirmButtonText: 'OK',
      cancelButtonText: 'Batal',
      confirmButtonColor: ALERT_THEME.primary,
      cancelButtonColor: ALERT_THEME.light,
      confirmButtonClass: getButtonClass('confirm'),
      cancelButtonClass: getButtonClass('cancel'),
      didOpen: () => {
        const select = document.getElementById('swal-select');
        if (config.defaultValue) {
          select.value = config.defaultValue;
        }
        select.focus();
      },
      preConfirm: () => {
        const select = document.getElementById('swal-select');
        if (!select.value) {
          Swal.showValidationMessage('Silakan pilih opsi');
          return false;
        }
        return select.value;
      },
      ...config,
    });
  };

  // ================================================================
  // PROGRESS & STEPS
  // ================================================================

  /**
   * Show steps/progress dialog
   * @param {string} title - Dialog title
   * @param {Array} steps - Steps array
   * @param {Object} options - Additional options
   * @returns {Promise}
   */
  const steps = (title, steps = [], options = {}) => {
    return Swal.fire({
      ...getDefaultConfig(),
      title: title,
      html: `
        <div class="swal-steps">
          ${steps
            .map(
              (step, index) =>
                `<div class="swal-step ${index === 0 ? 'active' : ''}">
                  <span class="swal-step-number">${index + 1}</span>
                  <span class="swal-step-label">${step}</span>
                </div>`
            )
            .join('')}
        </div>
      `,
      confirmButtonText: 'OK',
      confirmButtonColor: ALERT_THEME.primary,
      confirmButtonClass: getButtonClass('confirm'),
      ...options,
    });
  };

  // ================================================================
  // FIRE GENERIC ALERT
  // ================================================================

  /**
   * Fire generic alert dengan full control
   * @param {Object} config - Swal config object
   * @returns {Promise}
   */
  const fire = (config = {}) => {
    if (typeof Swal === 'undefined') {
      console.error('[SWEETALERT] Swal not available');
      return Promise.reject(new Error('Swal not available'));
    }
    return Swal.fire({
      ...getDefaultConfig(),
      ...config,
    });
  };

  // ================================================================
  // PUBLIC API
  // ================================================================

  return {
    // Theme colors
    THEME: ALERT_THEME,

    // Alert functions
    success,
    error,
    warning,
    info,
    confirm,
    confirmDelete,
    custom,
    loading,
    toast,

    // Control functions
    close,
    hide,
    show,
    enableConfirm,
    disableConfirm,
    update,

    // Promise-based helpers
    asyncConfirm,
    asyncConfirmDelete,
    successAutoClose,
    errorAutoClose,

    // Input dialogs
    textInput,
    emailInput,
    textareaInput,
    selectInput,

    // Other
    steps,
    fire,
  };
})();

// Log when module is loaded
if (typeof window !== 'undefined') {
  console.log('[SWEETALERT] Module loaded successfully');
}
